<!DOCTYPE html>
<html lang="en">

<head>
    <title>Image</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="matter.css">
    <!--     <script src="index.js"></script>
 -->
</head>

<body onload="load()" onresize="resize()">
    <header id="header">
        <div class="matter-menubar">
            <ul>
                <li onclick="show_home_panel()" style="cursor:pointer;">Home</li>
                <li>Project
                    <ul>
                        <li onclick="open_project_from_json_file()" title="Open project (from a JSON file)">Open</li>
                        <li onclick="save_project_with_confirm()" title="Save project (as a JSON file)">Save</li>
                        <li class="submenu-divider"></li>
                        <li onclick="project_add_files()" title="Add files">Add files</li>
                        <li onclick="project_remove_file()" title="Remove selected file">Remove file</li>
                    </ul>
                </li>
                <li>Preview
                    <ul>
                        <li onclick="" title="Show clean image">Clean</li>
                        <li onclick="" title="Show color image">Color</li>
                        <li onclick="" title="Show zoom image">Zoom</li>
                        <li onclick="" title="Show atch image">Patch</li>
                    </ul>
                </li>
                <li>Help
                    <ul>
                        <li onclick="" title="Show a guide to getting started">Getting Started</li>
                        <li class="submenu-divider"></li>
                        <li onclick="" title="Show more details about this application">About</li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <main id="main">
        <leftside id="leftside">
            <label class="matter-textfield-filled" style="width: 100%; height: 64px;">
                <input placeholder="" onchange="change_project_name(this)" id="project_name" />
                <span>Project</span>
            </label>
            <div id="image_filename_list" style="display: block;">
                <ul>
                    <li id="fl0" class="jump_to_image(0)" onclick="jump_to_image(0)" title="01_noise.png">[1] 01_noise.png</li>
                    <li id="fl1" onclick="jump_to_image(1)" title="02_noise.png" class="sel">[2] 02_noise.png</li>
                    <li id="fl2" onclick="jump_to_image(2)" title="03_noise.png">[3] 03_noise.png</li>
                </ul>
            </div>
            <div style="justify-content: space-around;">
                <span class="matter-button-contained" onclick="project_add_files()" title="Add files">Add Files</span>
                <span class="matter-button-contained" onclick="project_remove_file()" title="Remove selected file">Remove File</span>
            </div>
        </leftside>
        <workspace id="workspace">
            <img id="start_image" src="mountain.jpg" style="width:100%;height:100%;" alt="Image" />
            <canvas id="load_canvas" tabindex="1" style="display:block;border:1px dashed red;">
            </canvas>
        </workspace>
    </main>
    <footer id="footer">
        <div id="message_id" class="matter-message" class="matter-h4" style="display:none">message</div>
        <progress class="matter-progress-linear" value="0" max="100" style="display:none">Cleaning ...</progress>
    </footer>
</body>
<script type="text/javascript">
"use strict";

// var panel = new ShiftPanel();
// var message = new Message("message_id");
// var progress = new Progress(0);
// var load_canvas = new Canvas("load_canvas");

function load() {
    // message.show("Image Cleaning/Coloring/Zooming/Patching is ready ...", 10);
    // progress.startDemo(0); // start 0

    // panel.add("start_image");
    // panel.add("load_canvas");

    // panel.test();

    var project = document.getElementById("project_name");
    project.value = get_default_project_name();

    window.addEventListener("keydown", (e) => {
        // e : KeyboardEvent
        if (e.key == 'Shift') {
            leftside_toggle();
        }
    }, false);
}

function loadImage() {
    selectFiles("images/*", false).then((files) => {
        load_canvas.loadBackground(files[0]);
    });
}

function change_project_name() {
    var e = document.getElementById("project_name");

    alert("project name: " + e.value);
}

function leftside_toggle() {
    show_or_hiden("leftside");
}

function show_or_hiden(id) {
    var elem = document.getElementById(id);
    if (elem)
        elem.style.display = (elem.style.display == "none") ? "" : "none";
    else
        console.log("Error: element " + id + " not exists.");
}

function resize() {
    // adjust main size ...
    var w = document.documentElement.clientWidth;
    var h = document.documentElement.clientHeight;
    var header = document.getElementById("header");
    var footer = document.getElementById("footer");
    var main = document.getElementById("main");
    var leftside = document.getElementById("leftside");

    h -= header.clientHeight;
    h -= footer.clientHeight;
    w -= leftside.clientWidth;
    main.style.height = h + 'px';
    main.style.width = w + 'px';
}

function number_padding_with_zeros(num, n) {
    var len = num.toString().length;
    while (len < n) {
        num = "0" + num;
        len++;
    }
    return num;
}

function get_default_project_name() {
    const now = new Date();
    var ts = now.getFullYear() + "" + number_padding_with_zeros(now.getMonth() + 1, 2) + "" + number_padding_with_zeros(now.getDate(), 2) +
        "_" + number_padding_with_zeros(now.getHours(), 2) + "" + number_padding_with_zeros(now.getMinutes(), 2);
    var project_name = 'image_' + ts;
    return project_name;
}
</script>

</html>